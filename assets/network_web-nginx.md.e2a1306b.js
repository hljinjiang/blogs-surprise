import{_ as s,c as n,o as a,O as l}from"./chunks/framework.d7e37bdc.js";const u=JSON.parse('{"title":"Nginx","description":"","frontmatter":{},"headers":[],"relativePath":"network/web-nginx.md","filePath":"network/web-nginx.md","lastUpdated":1689227711000}'),p={name:"network/web-nginx.md"},e=l(`<h1 id="nginx" tabindex="-1">Nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;Nginx&quot;">​</a></h1><h2 id="负载均衡" tabindex="-1">负载均衡 <a class="header-anchor" href="#负载均衡" aria-label="Permalink to &quot;负载均衡&quot;">​</a></h2><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">upstream</span><span style="color:#F8F8F2;"> nginx_boot{</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#88846F;"># 30s内检查心跳发送两次包，未回复就代表该机器宕机，请求分发权重比为1:2</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;">server</span><span style="color:#F8F8F2;"> 192.168.0.000:8080 </span><span style="color:#FD971F;font-style:italic;">weight</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;"> max_fails=2 </span><span style="color:#FD971F;font-style:italic;">fail_timeout</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">30s</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"><span style="color:#F8F8F2;">   server 192.168.0.000:8090 </span><span style="color:#FD971F;font-style:italic;">weight</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;"> max_fails=2 </span><span style="color:#FD971F;font-style:italic;">fail_timeout</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">30s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#88846F;"># 这里的IP请配置成你WEB服务所在的机器IP</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">server {</span></span>
<span class="line"><span style="color:#F8F8F2;">    location / {</span></span>
<span class="line"><span style="color:#F8F8F2;">        root   html;</span></span>
<span class="line"><span style="color:#F8F8F2;">       </span><span style="color:#F92672;"> index </span><span style="color:#F8F8F2;"> index.html index.htm</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#88846F;"># 允许重新定义或者添加发往后端服务器的请求头IP</span></span>
<span class="line"><span style="color:#F8F8F2;">        proxy_set_header Host $host;</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#88846F;"># 它代表客户端，也就是HTTP的请求端真实的IP</span></span>
<span class="line"><span style="color:#F8F8F2;">       </span><span style="color:#F92672;"> proxy_set_header </span><span style="color:#F8F8F2;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#F8F8F2;">       </span><span style="color:#F92672;"> proxy_set_header </span><span style="color:#F8F8F2;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#88846F;"># 请求交给名为nginx_boot的upstream上</span></span>
<span class="line"><span style="color:#F8F8F2;">       </span><span style="color:#F92672;"> proxy_pass </span><span style="color:#F8F8F2;">http://nginx_boot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="动静分离" tabindex="-1">动静分离 <a class="header-anchor" href="#动静分离" aria-label="Permalink to &quot;动静分离&quot;">​</a></h2><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;"># ~代表匹配时区分大小写</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">location</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">~</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">.*\\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)</span><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 指向文件服务器目录</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> root </span><span style="color:#F8F8F2;">  /nginx/static_resources;</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> expires </span><span style="color:#F8F8F2;">7d;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="压缩" tabindex="-1">压缩 <a class="header-anchor" href="#压缩" aria-label="Permalink to &quot;压缩&quot;">​</a></h2><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">http{</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 开启压缩机制</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip </span><span style="color:#F8F8F2;">on;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 指定会被压缩的文件类型(也可自己配置其他类型)</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_types </span><span style="color:#F8F8F2;">text/plain application/javascript text/css application/xml text/javascript image/jpeg image/gif image/png;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 设置压缩级别，越高资源消耗越大，但压缩效果越好</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_comp_level </span><span style="color:#F8F8F2;">5;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 在头部中添加Vary: Accept-Encoding（建议开启）</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_vary </span><span style="color:#F8F8F2;">on;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 处理压缩请求的缓冲区数量和大小</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_buffers </span><span style="color:#F8F8F2;">16 </span><span style="color:#AE81FF;">8k</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 对于不支持压缩功能的客户端请求不开启压缩机制</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_disable </span><span style="color:#E6DB74;">&quot;MSIE [1-6]\\.&quot;</span><span style="color:#F8F8F2;">; </span><span style="color:#88846F;"># 低版本的IE浏览器不支持压缩</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 设置压缩响应所支持的HTTP最低版本</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_http_version </span><span style="color:#F8F8F2;">1.1;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 设置触发压缩的最小阈值</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_min_length </span><span style="color:#F8F8F2;">2k;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;"># 关闭对后端服务器的响应结果进行压缩</span></span>
<span class="line"><span style="color:#F8F8F2;">   </span><span style="color:#F92672;"> gzip_proxied </span><span style="color:#F8F8F2;">off;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="缓存" tabindex="-1">缓存 <a class="header-anchor" href="#缓存" aria-label="Permalink to &quot;缓存&quot;">​</a></h2><h2 id="跨域" tabindex="-1">跨域 <a class="header-anchor" href="#跨域" aria-label="Permalink to &quot;跨域&quot;">​</a></h2>`,9),o=[e];function r(c,t,F,i,y,b){return a(),n("div",null,o)}const d=s(p,[["render",r]]);export{u as __pageData,d as default};
